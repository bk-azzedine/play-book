<div class="flex flex-col bg-gray-50 min-h-screen">
  <hlm-toaster/>
  <div>
    <div class="flex flex-col ">
      <div class="flex items-center w-full h-24 pl-10 pr-5">
        <div class="pt-10 pl-5 pb-0 flex flex-row items-center space-x-5">
          <ng-icon name="{{space?.icon}}" size="25" strokeWidth="2"></ng-icon>
          <span class="text-black text-xl font-bold">{{ space?.name }}</span>
        </div>
        <div class="flex-1 flex justify-center pt-12 ">
          <button hlmBtn
                  class="flex items-center gap-3 p-3 rounded-md hover:bg-secondary cursor-pointer transition-colors  bg-background"
                  [brnMenuTriggerFor]="documentMenu">
            <ng-icon name="featherMoreVertical" size="20" class="text-gray-500"></ng-icon>
          </button>
        </div>
      </div>

      <div class="flex items-center w-full h-24 pl-20 ">
        <span class="text-black text-lg font-bold">{{ space?.description }}</span>
      </div>
    </div>

    <div class="flex-1 px-6 py-6">
      <div class="grid grid-cols-1 gap-4 max-w-2xl">
        <app-doc-card
          *ngFor="let doc of spaceDocuments"
          [documentSignal]="doc"
          [widthSignal]="96"
          [heightSignal]="56"
          (click)="view(doc.id)"
        >
        </app-doc-card>
      </div>
    </div>
  </div>
</div>

<ng-template #documentMenu>
  <hlm-menu class="p-4 bg-[#F1F0FC] rounded-md shadow-lg min-w-48 border-none dropdown-animation">
    <div>
      <button
        class="user-menu-item flex items-center w-full px-3 py-2 text-left hover:bg-gray-100 rounded"
        [brnDialogTriggerFor]="dialog"
        (click)="populateEditForm()">
        <div class="flex items-center w-full">
          <div class="icon-container flex items-center justify-center mr-3">
            <ng-icon name="lucidePencilLine" size="20"/>
          </div>
          <span class="user-menu-text">
             Edit space
          </span>
        </div>
      </button>

        <button
          class="user-menu-item flex items-center w-full px-3 py-2 text-left hover:bg-gray-100 rounded"
          [brnAlertDialogTriggerFor]="alertDialogue"
        >
          <div class="flex items-center w-full">
            <div class="icon-container flex items-center justify-center mr-3">
              <ng-icon name="lucideTrash" size="20"/>
            </div>
            <span class="user-menu-text">
           Delete space
          </span>
          </div>
        </button>

      <button
        class="user-menu-item flex items-center w-full px-3 py-2 text-left hover:bg-gray-100 rounded"
      >
        <div class="flex items-center w-full">
          <div class="icon-container flex items-center justify-center mr-3">
            <ng-icon name="lucidePlus" size="20"/>
          </div>
          <span class="user-menu-text">
           Add people
          </span>
        </div>
      </button>
    </div>
  </hlm-menu>
</ng-template>

<brn-dialog #dialog>
  <form
    class="w-full flex flex-col items-center justify-center max-w-md mx-auto space-y-6"
    [formGroup]="spaceForm"
    (ngSubmit)="saveSpace()"
  >
    <hlm-dialog-content *brnDialogContent="let ctx"
                        class="sm:max-w-xl w-full bg-[#F1F0FC] border-none shadow-lg max-h-[75vh] flex flex-col">
      <ng-scrollbar class="w-full h-full border-none flex-grow">
        <div class="bg-[#F1F0FC] p-3 rounded-t-lg">
          <h3
            class="text-xl font-bold text-black mb-4">{{ space ? 'Edit Space' : 'Create a new space for your team' }}</h3>

          <div class="mb-5">
            <label class="block text-sm font-medium text-black mb-2">Space Name</label>
            <input
              hlmInput
              id="name"
              placeholder="Enter space name"
              formControlName="name"
              class="w-full bg-background border border-indigo-200 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"
            />
            <hlm-error *ngIf="spaceForm.get('name')?.hasError('maxlength')">the max length for the name is 20
              characters
            </hlm-error>

          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-black mb-2">Space Icon</label>
            <div
              class="flex flex-wrap gap-3 max-h-36 overflow-y-auto p-3 bg-background rounded-md border border-indigo-200">
              <button
                type="button"
                *ngFor="let icon of icons; let i = index"
                class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-indigo-100 transition-all"
                [class.ring-2]="selectedIconIndex === i"
                [class.ring-indigo-500]="selectedIconIndex === i"
                (click)="selectIcon(i)">
                <ng-icon [name]="icon" size="20" [color]="selectedIconIndex === i ? '#4f46e5' : '#6366f1'"></ng-icon>
              </button>
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-black mb-2">Description</label>
            <textarea
              hlmInput
              id="description"
              formControlName="description"
              placeholder="What's this space about?"
              class="w-full h-24 bg-background border border-indigo-200 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 resize-none"
            ></textarea>
            <hlm-error *ngIf="spaceForm.get('description')?.hasError('maxlength')">the max length for the description is
              200 characters
            </hlm-error>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-black mb-2">Visibility</label>
            <hlm-radio-group
              class="flex flex-row space-x-4"
              formControlName="visibility"
            >
              <label class="flex items-center gap-2 cursor-pointer" hlmLabel>
                <hlm-radio [value]="SpaceVisibilityEnum.PUBLIC">
                  <hlm-radio-indicator indicator></hlm-radio-indicator>
                </hlm-radio>
                <div class="flex items-center gap-1">
                  <ng-icon name="heroGlobeAlt" size="16" class="text-indigo-600"></ng-icon>
                  <span>Public</span>
                </div>
              </label>
              <label class="flex items-center gap-2 cursor-pointer" hlmLabel>
                <hlm-radio [value]="SpaceVisibilityEnum.PRIVATE">
                  <hlm-radio-indicator indicator></hlm-radio-indicator>
                </hlm-radio>
                <div class="flex items-center gap-1">
                  <ng-icon name="heroLockClosed" size="16" class="text-indigo-600"></ng-icon>
                  <span>Private</span>
                </div>
              </label>
            </hlm-radio-group>
          </div>
        </div>
      </ng-scrollbar>

      <div class="flex justify-end gap-3 mt-auto p-6">
        <button
          type="button"
          hlmBtn
          variant="outline"
          class="border-indigo-200 text-indigo-600 hover:bg-indigo-50"
          (click)="ctx.close()">
          Cancel
        </button>
        <button
          (click)="saveSpace()"
          type="submit"
          hlmBtn
          class="bg-indigo-600 hover:bg-indigo-700 text-white flex items-center gap-1"
        >
          <ng-icon name="heroPlus" size="16" color="white"></ng-icon>
          {{ space ? 'Save Changes' : 'Create Space' }}
        </button>
      </div>
    </hlm-dialog-content>
  </form>
</brn-dialog>


<hlm-alert-dialog #alertDialogue>
<hlm-alert-dialog-content *brnAlertDialogContent="let ctx">
  <hlm-alert-dialog-header>
    <h3 hlmAlertDialogTitle>Are you absolutely sure?</h3>
    <p hlmAlertDialogDescription>
      This action cannot be undone. This will permanently delete your space and remove all documents from our
      servers.
    </p>
  </hlm-alert-dialog-header>
  <hlm-alert-dialog-footer>
    <button hlmAlertDialogCancel (click)="ctx.close()">Cancel</button>
    <button hlmBtn (click)="ctx.close(); deleteSpace()" class="w-30 h-10 hover:bg-accent hover:text-accent-foreground">Delete Space</button>
  </hlm-alert-dialog-footer>
</hlm-alert-dialog-content>
</hlm-alert-dialog>

